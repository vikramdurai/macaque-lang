Fixed #2 with really ugly code